# M5_forecasting
Домашняя работа в рамках курса Big Data Высшей Школы Экономики.

Выбрана задача предсказания количества продаж по магазинам по дням.

### BaseLine (линейная регрессия)
В качестве BaseLine для предсказания была выбрана модель линейной регрессии. Использованы следующие признаки:
- `lag_1, lag_2, lag_3, lag_4, lag_5, lag_6, lag_7` - смещение по количеству продаж на 1 - 7 дней соответственно;
- `sales_wmean` - среднее значение продаж за предыдущую неделю.

`lag_1 - lag_7` в качестве признаков выбраны не случайно. Разложив наши данные по уровню продаж в частотный спектр с помощью прямого преобразования Фурье стало отчетливо видно, что данным характерна недельная сезонность (максимальный пик приходит на значение 7-ми дней.  
Недостатками данного подхода являются:
- в Рождество, в связи с тем, что магазины в этот день не работают, продажи отсутствовали или практически отсутствовали. Эти дни были удалены из выборки. Продажи в Рождество были отражены в последующих днях в признаках `lag_1 - lag_7`. Поэтому и последующие дни также были удалены (они имели null значения).
- прогнозирование происходит только для последующего дня. Качество прогнозирования для большего периода - сомнительно.

Для оценки качества использовалась метрика MAPE.  
Значения метрики качества MAPE для линейной модели:
- MAPE for LinearRegression (BaseLine), train: 11.01%
- MAPE for LinearRegression (BaseLine), test: 10.47%
 
 
### RandomForest
Для улучшения качества прогнозирования по сравнению с BaseLine была использована модель RandomForest.  
Признаки, использованные при построении модели:
- `store_id_enc` - закодированный id магазина (label encoding);
- `lag_1, lag_2, lag_3, lag_4, lag_5, lag_6, lag_7` - смещение по количеству продаж на 1 - 7 дней соответственно;
- `wday` - день недели;
- `month` - месяц;
- `mean_day` - среднее значение в этот день за три прошедших года по магазинам;
- `event_name_1_enc` - закодированное значение категориальной переменной event_name_1 (label encoding);
- `event_name_2_enc` - закодированное значение категориальной переменной event_name_2 (label encoding);
- `days_before_event` - осталось дней до `event_name_1` или `event_name_2`;
- `snap` - двоичная переменная (0 или 1), указывающая, разрешают ли магазины покупки по протоколу SNAP в проверяемую дату. 1 означает, что покупки по протоколу SNAP разрешены.

Недостатками этой модели являются те же недостатки, перечисленные для линейной модели BaseLine.

Значения метрики качества MAPE для RandomForest:
- MAPE for RandomForest, train: 6.75%
- MAPE for RandomForest, test: 7.71%
